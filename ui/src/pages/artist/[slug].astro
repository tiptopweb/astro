---

import BaseLayout from '../../layouts/BaseLayout.astro';

// Running at build time

export async function getStaticPaths() {

  const data = await fetch('https://astro.tiptopweb.com.au/find-artists?format=json').then(response => response.json());
  return data.results.map((artist) => {
      var regEx1 = new RegExp('[^\\w ]+', 'g');
      var regEx2 = new RegExp(' +', 'g');
      var slug = artist.name.toLowerCase().replace(regEx1, '').replace(regEx2, '-');
      return {
        params: { slug: slug },
        props: { artist },
      };
    });
}

const { slug } = Astro.request.params;
const { artist } = Astro.props;
---

<BaseLayout title={artist.name}>
    <h1 class="text-4xl py-4">{artist.name}</h1>
    <p class="text-2xl py-4">List of albums:</p>
    <ul>
      {artist.albums?.map(album => <li>{album.title}</li>)}
    </ul>
    <p class="py-4"><a class="underline text-orange-600 hover:text-orange-800" href="/">back to list of artists</a></p>
</BaseLayout>