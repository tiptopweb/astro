---
// Running at build time

export async function getStaticPaths() {

  const data = await fetch('https://astro.tiptopweb.com.au/find-artists?format=json').then(response => response.json());
  return data.results.map((artist) => {
      var regEx1 = new RegExp('[^\\w ]+', 'g');
      var regEx2 = new RegExp(' +', 'g');
      var slug = artist.name.toLowerCase().replace(regEx1, '').replace(regEx2, '-');
      return {
        params: { slug: slug },
        props: { artist },
      };
    });
}

const { slug } = Astro.request.params;
const { artist } = Astro.props;
---

<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>{artist.name}</title>

	<link rel="icon" type="image/x-icon" href="/favicon.ico" />
	<style global>
		@import "../../styles/global.css";
		@import "../../styles/home.css";
	</style>

	<style>
		header {
			display: flex;
			flex-direction: column;
			gap: 1em;
			max-width: min(100%, 68ch);
		}
	</style>
</head>
<body>
	<main>
		<header>
			<div>
				<img src="/assets/logo.svg" alt="Astro logo">
				<h1>+</h1>
				<img src="/assets/servicestack.svg" style="height:1.2em" alt="ServiceStack logo">
			</div>
		</header>
		<p><br/><p>
		<h1>{artist.name}</h1>
		<p><br/><p>	
		<p>List of albums:</p>
		<ul>
          {artist.albums?.map(album => <li>{album.title}</li>)}
        </ul>
		<p><br/><p>	
		<p><a href="/">back to list of artists</a></p>

	</main>
</body>
</html>
